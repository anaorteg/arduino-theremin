<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Arduino Theremin: /Users/brianmclaughlin/Documents/arduino/arduino-theremin/arduino-source/theremin/theremin.ino File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Arduino Theremin
   
   </div>
   <div id="projectbrief">Creation of a Theremin utilizing the Arduino environment.</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">/Users/brianmclaughlin/Documents/arduino/arduino-theremin/arduino-source/theremin/theremin.ino File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Arduino Based Theremin - Utilizes a 4.11 MHz LC Oscillator </p>
<dl class="section copyright"><dt>Copyright:</dt><dd>Copyright (C) 2012 Brian McLaughlin GNU Public License (GPL) v3. </dd></dl>
 
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;avr/wdt.h&gt;</code><br/>
<code>#include &lt;avr/interrupt.h&gt;</code><br/>
<code>#include &lt;avr/pgmspace.h&gt;</code><br/>
</div>
<p><a href="theremin_8ino_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals.html#ga4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="memdesc:ga4fc01d736fe50cf5b977f755b675f11d"><td class="mdescLeft">&#160;</td><td class="mdescRight">The standard Arduino <em>setup</em> function.  <a href="group__globals.html#ga4fc01d736fe50cf5b977f755b675f11d"></a><br/></td></tr>
<tr class="memitem:gafe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals.html#gafe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="memdesc:gafe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">The standard Arduino <em>loop</em> function.  <a href="group__globals.html#gafe461d27b9c48d5921c00d521181f12f"></a><br/></td></tr>
<tr class="memitem:gadc3f86fb035dd66911f621a199f3d6b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals.html#gadc3f86fb035dd66911f621a199f3d6b0">watchdog_setup</a> ()</td></tr>
<tr class="memdesc:gadc3f86fb035dd66911f621a199f3d6b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set-up the Watchdog timer registers.  <a href="group__globals.html#gadc3f86fb035dd66911f621a199f3d6b0"></a><br/></td></tr>
<tr class="memitem:ga09dd35e11fe4a5c9278847c009477602"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals.html#ga09dd35e11fe4a5c9278847c009477602">timer1_setup</a> ()</td></tr>
<tr class="memdesc:ga09dd35e11fe4a5c9278847c009477602"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set-up Timer/Counter 1 registers.  <a href="group__globals.html#ga09dd35e11fe4a5c9278847c009477602"></a><br/></td></tr>
<tr class="memitem:ga14bcc531b1ef936801d01efc65917812"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals.html#ga14bcc531b1ef936801d01efc65917812">timer2_setup</a> ()</td></tr>
<tr class="memdesc:ga14bcc531b1ef936801d01efc65917812"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set-up Timer/Counter 2 registers.  <a href="group__globals.html#ga14bcc531b1ef936801d01efc65917812"></a><br/></td></tr>
<tr class="memitem:ga43905d6fb5c4d433a49f527fa6ab811f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga43905d6fb5c4d433a49f527fa6ab811f"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals.html#ga43905d6fb5c4d433a49f527fa6ab811f">ISR</a> (WDT_vect)</td></tr>
<tr class="memdesc:ga43905d6fb5c4d433a49f527fa6ab811f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Watchdog Timer Interrupt Service Routine. <br/></td></tr>
<tr class="memitem:gab16889ae984b9b798989a0d239283cac"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gab16889ae984b9b798989a0d239283cac"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals.html#gab16889ae984b9b798989a0d239283cac">ISR</a> (TIMER1_OVF_vect)</td></tr>
<tr class="memdesc:gab16889ae984b9b798989a0d239283cac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timer/Counter 1 Overflow Interrupt Service Routine. <br/></td></tr>
<tr class="memitem:ga7cfcbe42bd266750aeb6e5d71e5ea479"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga7cfcbe42bd266750aeb6e5d71e5ea479"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals.html#ga7cfcbe42bd266750aeb6e5d71e5ea479">ISR</a> (TIMER2_OVF_vect)</td></tr>
<tr class="memdesc:ga7cfcbe42bd266750aeb6e5d71e5ea479"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timer/Counter 2 Overflow Interrupt Service Routine. <br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga1d58135a8b47accb48a9572252272460"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga1d58135a8b47accb48a9572252272460"></a>
PROGMEM prog_uchar&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-waveform.html#ga1d58135a8b47accb48a9572252272460">sine256</a> []</td></tr>
<tr class="memdesc:ga1d58135a8b47accb48a9572252272460"><td class="mdescLeft">&#160;</td><td class="mdescRight">Table of 256 sine values, one sine period, stored in flash memory. <br/></td></tr>
<tr class="memitem:ga7febbeaa817de864b39bfb686b8d8200"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga7febbeaa817de864b39bfb686b8d8200"></a>
const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-pins.html#ga7febbeaa817de864b39bfb686b8d8200">PIN_RF_FREQ</a> = 5</td></tr>
<tr class="memdesc:ga7febbeaa817de864b39bfb686b8d8200"><td class="mdescLeft">&#160;</td><td class="mdescRight">RF Frequency input from oscillator (RESERVED FOR TIMER 1 INPUT) <br/></td></tr>
<tr class="memitem:ga862e7a628eb66f12daf7aba92081bb75"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga862e7a628eb66f12daf7aba92081bb75"></a>
const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-pins.html#ga862e7a628eb66f12daf7aba92081bb75">PIN_AUDIO_OUT</a> = 11</td></tr>
<tr class="memdesc:ga862e7a628eb66f12daf7aba92081bb75"><td class="mdescLeft">&#160;</td><td class="mdescRight">PWM Based Audio Output from Arduino. <br/></td></tr>
<tr class="memitem:ga4fd783695c25b9ced260c4ae38782e4f"><td class="memItemLeft" align="right" valign="top">const unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-constants.html#ga4fd783695c25b9ced260c4ae38782e4f">TIMER1_ROLLOVER_VALUE</a> = 0xFFFF</td></tr>
<tr class="memdesc:ga4fd783695c25b9ced260c4ae38782e4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timer/Counter 1 is a 16-bit counter so it rolls over at 0xFFFF.  <a href="group__globals-constants.html#ga4fd783695c25b9ced260c4ae38782e4f"></a><br/></td></tr>
<tr class="memitem:gafaf07345193d633dc676404a52e2dd56"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gafaf07345193d633dc676404a52e2dd56"></a>
const unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-constants.html#gafaf07345193d633dc676404a52e2dd56">DDS_COEFFICIENT</a> = 65536</td></tr>
<tr class="memdesc:gafaf07345193d633dc676404a52e2dd56"><td class="mdescLeft">&#160;</td><td class="mdescRight"><img class="formulaInl" alt="$ 2^16 $" src="form_0.png"/> (size of an unsigned integer or 16 bits) <br/></td></tr>
<tr class="memitem:ga532a3aa7abae74d163c979828dafb6ef"><td class="memItemLeft" align="right" valign="top">const unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-constants.html#ga532a3aa7abae74d163c979828dafb6ef">DDS_REFERENCE_CLOCK</a> = 31377</td></tr>
<tr class="memdesc:ga532a3aa7abae74d163c979828dafb6ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">The frequency of the watch-dog timer clock overflow.  <a href="group__globals-constants.html#ga532a3aa7abae74d163c979828dafb6ef"></a><br/></td></tr>
<tr class="memitem:ga301908d1c1d203d9bd9623a310e00c7b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga301908d1c1d203d9bd9623a310e00c7b"></a>
const unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-constants.html#ga301908d1c1d203d9bd9623a310e00c7b">OSCILLATOR_FREQUENCY</a> = 4112254</td></tr>
<tr class="memdesc:ga301908d1c1d203d9bd9623a310e00c7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The hardware resonator is tuned to 4.11 MHz. <br/></td></tr>
<tr class="memitem:gaaa89f188c977b289de49c3230bb21298"><td class="memItemLeft" align="right" valign="top">volatile unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-volatiles.html#gaaa89f188c977b289de49c3230bb21298">frequency_input_overflow</a> = 0</td></tr>
<tr class="memdesc:gaaa89f188c977b289de49c3230bb21298"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frequency input overflow.  <a href="group__globals-volatiles.html#gaaa89f188c977b289de49c3230bb21298"></a><br/></td></tr>
<tr class="memitem:ga15ab42c386b8f4fc9766a4af70b1d03d"><td class="memItemLeft" align="right" valign="top">volatile unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-volatiles.html#ga15ab42c386b8f4fc9766a4af70b1d03d">dds_phase_accumulator</a> = 0</td></tr>
<tr class="memdesc:ga15ab42c386b8f4fc9766a4af70b1d03d"><td class="mdescLeft">&#160;</td><td class="mdescRight">DDS phase accumulator.  <a href="group__globals-volatiles.html#ga15ab42c386b8f4fc9766a4af70b1d03d"></a><br/></td></tr>
<tr class="memitem:ga411b26fb51750078b83ed9b5d17c89ff"><td class="memItemLeft" align="right" valign="top">volatile unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__globals-volatiles.html#ga411b26fb51750078b83ed9b5d17c89ff">dds_jump_size</a> = 0</td></tr>
<tr class="memdesc:ga411b26fb51750078b83ed9b5d17c89ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">DDS tuning word M.  <a href="group__globals-volatiles.html#ga411b26fb51750078b83ed9b5d17c89ff"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Arduino Based Theremin - Utilizes a 4.11 MHz LC Oscillator </p>
<dl class="section copyright"><dt>Copyright:</dt><dd>Copyright (C) 2012 Brian McLaughlin GNU Public License (GPL) v3. </dd></dl>
<dl class="section user"><dt></b></dt><dd>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</dd></dl>
<dl class="section user"><dt></b></dt><dd>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</dd></dl>
<dl class="section user"><dt></b></dt><dd>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a> .</dd></dl>
<dl class="section date"><dt>Date:</dt><dd>2012 </dd></dl>
<dl class="section author"><dt>Author:</dt><dd>Brian McLaughlin </dd></dl>
<dl class="section version"><dt>Version:</dt><dd>0.1.1</dd></dl>
<p>An implementation of a Theremin in the Arduino environment. Actually, you might not recognize a lot of the code if you are used to the Arduino programming environment only. I make a lot of call to the ATMega registers on the chip and there is no work done in the <em>loop</em> function as all the work is done via timer interrupts!</p>
<p>Original code came from Martin Nawrath for KHM in 2008. This is also where the oscillator schematic originated. The code has been changed to the point where there is nothing left of the original code, however the concept and the schematic are greatly appreciated. <a href=" http://goo.gl/kCJp6">Original Project Website</a></p>
<dl class="section note"><dt>Note:</dt><dd>This code relies heavily on an understanding of the ATmega design, specifically the ATmega328 for this version. I have attempted to comment low-level functionality in code for better understanding but it is always best to refer the datasheet to really get your best understanding. The datasheet for the ATmega328, the chip used in the Arduino Uno, can be found at: <a href="http://www.atmel.com/devices/atmega328.aspx">http://www.atmel.com/devices/atmega328.aspx</a></dd></dl>
<dl class="section warning"><dt>Warning:</dt><dd>Systems such as this, where timing is critical, are very sensitive to changes in physical setup and code changes. If you make some code changes you may find it necessary to re-tune the system. It will probably work but the output frequencies may be a little different than exepected.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Add a physical button interface to trigger an auto-calibration feature. </dd></dl>

<p>Definition in file <a class="el" href="theremin_8ino_source.html">theremin.ino</a>.</p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 16 2012 20:17:29 for Arduino Theremin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
